<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>00:00:00 - Timer Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #c4b5fd;
            --text-color: #ffffff;
            --number-bg: rgba(255, 255, 255, 0.15);
            --accent-color: #38bdf8;
            --transition-speed: 0.5s;
            --toggle-bg: rgba(255, 255, 255, 0.2);
            --flip-bg: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --number-bg: rgba(30, 41, 59, 0.8);
            --accent-color: #6366f1;
            --toggle-bg: rgba(30, 41, 59, 0.5);
            --flip-bg: #1e293b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; color: var(--text-color);
            transition: background-color var(--transition-speed);
            overflow: hidden;
        }

        /* Thanh ƒëi·ªÅu khi·ªÉn tr√™n c√πng */
        .top-controls {
            position: absolute; top: 20px; right: 20px;
            display: flex; gap: 10px; z-index: 1001;
        }

        .control-panel {
            display: flex; background: var(--toggle-bg);
            padding: 4px; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer; gap: 4px;
        }

        .switch-icon {
            padding: 8px 12px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s; opacity: 0.5;
        }

        .switch-icon svg { width: 18px; height: 18px; fill: currentColor; }

        [data-theme="purple"] #sun-icon, 
        [data-theme="dark"] #moon-icon,
        .active-style {
            background: rgba(255, 255, 255, 0.15);
            opacity: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .main-container { text-align: center; width: 100%; max-width: 800px; padding: 20px; position: relative; z-index: 10; }
        .title { font-size: 1rem; letter-spacing: 2px; margin-bottom: 2rem; text-transform: uppercase; font-weight: 700; min-height: 1.5rem; }

        .timer-wrapper { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 2.5rem; }

        /* Giao di·ªán s·ªë m·∫∑c ƒë·ªãnh */
        .number-slot {
            background: var(--number-bg);
            font-size: clamp(2rem, 10vw, 5.5rem);
            font-weight: 800; padding: 20px;
            border-radius: 16px; min-width: 130px;
            border: 1px solid rgba(255,255,255,0.2);
            outline: none; transition: all 0.3s;
            position: relative;
        }

        /* Giao di·ªán s·ªë Flip (·∫£nh b67598) */
        [data-style="flip"] .number-slot {
            background: var(--flip-bg);
            border-radius: 8px;
            border: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.05) 50%, rgba(0,0,0,0.05) 50%);
        }
        [data-style="flip"] .number-slot::after {
            content: ""; position: absolute; left: 0; top: 50%; width: 100%; height: 2px;
            background: rgba(0,0,0,0.4); transform: translateY(-50%);
        }

        .number-slot.editable {
            cursor: text; border: 2px solid var(--accent-color);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
        }

        .label { margin-top: 15px; font-size: 0.7rem; letter-spacing: 2px; opacity: 0.6; font-weight: 600; }
        .separator { font-size: 2.5rem; padding-bottom: 30px; opacity: 0.5; }

        .btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        
        button.action-btn {
            padding: 12px 20px; border: none; border-radius: 10px;
            font-weight: 700; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; font-size: 0.8rem;
        }

        .btn-primary { background: var(--accent-color); color: white; }
        .btn-stop { background: #f43f5e; color: white; }
        .btn-reset { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }

        .dropdown { position: relative; display: inline-block; }
        .dropdown-content {
            visibility: hidden; opacity: 0;
            position: absolute; bottom: 100%; left: 50%;
            transform: translateX(-50%) translateY(10px);
            background-color: #1e293b; min-width: 220px;
            border-radius: 12px; border: 1px solid var(--accent-color);
            transition: 0.3s; z-index: 1000;
        }

        .dropdown:hover .dropdown-content { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(-10px); }

        .dropdown-content button {
            color: white; padding: 12px 16px; display: block;
            width: 100%; border: none; background: transparent;
            cursor: pointer; text-align: left; font-size: 0.8rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .dropdown-content button:hover { background: var(--accent-color); }

        #alarm-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center; 
            z-index: 2000; backdrop-filter: blur(10px);
        }
    </style>
</head>
<body data-theme="purple" data-style="default">

<div class="top-controls">
    <div class="control-panel" onclick="toggleStyle()" title="ƒê·ªïi giao di·ªán s·ªë">
        <div class="switch-icon" id="style-icon">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/></svg>
        </div>
    </div>

    <div class="control-panel" onclick="toggleTheme()">
        <div class="switch-icon" id="sun-icon">
            <svg viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0s-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0s-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41s-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41s-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>
        </div>
        <div class="switch-icon" id="moon-icon">
            <svg viewBox="0 0 24 24"><path d="M12.12 2.01c-1.72 1.53-2.78 3.73-2.78 6.18 0 4.6 3.73 8.32 8.32 8.32 1.27 0 2.48-.29 3.56-.8 1.1-.53 2.41.29 2.12 1.47-1.39 5.61-6.42 9.82-12.42 9.82-7.13 0-12.92-5.79-12.92-12.92 0-6.1 4.21-11.12 9.82-12.51 1.18-.29 2.01 1.02 1.47 2.13z"/></svg>
        </div>
    </div>
</div>

<div class="main-container">
    <div class="title" id="mode-text">S·∫¥N S√ÄNG</div>
    
    <div class="timer-wrapper">
        <div class="time-box"><div class="number-slot" id="hh" onfocus="clearIfZero(this)" onblur="validateEntry(this)">00</div><div class="label" id="l-h">HOUR</div></div>
        <div class="separator">:</div>
        <div class="time-box"><div class="number-slot" id="mm" onfocus="clearIfZero(this)" onblur="validateEntry(this)">00</div><div class="label" id="l-m">MIN</div></div>
        <div class="separator" id="sep-2">:</div>
        <div class="time-box" id="sec-box"><div class="number-slot" id="ss" onfocus="clearIfZero(this)" onblur="validateEntry(this)">00</div><div class="label" id="l-s">SEC</div></div>
    </div>

    <div class="btn-group">
        <div class="dropdown">
            <button class="action-btn btn-primary">Ch·∫ø ƒë·ªô ‚ñº</button>
            <div class="dropdown-content">
                <button onclick="startClockMode()">üïí Xem gi·ªù hi·ªán t·∫°i</button>
                <button onclick="startTetCountdown()">üèÆ T·∫øt Nguy√™n ƒê√°n 2026</button>
                <button onclick="enableManualEdit('countdown')">‚úçÔ∏è ƒê·∫øm Ng∆∞·ª£c</button>
                <button onclick="enableManualEdit('alarm')" style="color: #fbbf24;">‚è∞ ƒê·∫∂T B√ÅO TH·ª®C</button>
            </div>
        </div>
        <button class="action-btn btn-primary" id="main-action-btn" onclick="initTimer('stopwatch')">B·∫•m gi·ªù</button>
        <button class="action-btn btn-stop" id="pause-btn" onclick="togglePause()">T·∫°m d·ª´ng</button>
        <button class="action-btn btn-reset" onclick="resetAll()">Reset</button>
    </div>
</div>

<div id="alarm-modal">
    <div class="modal-content" style="background: #1e293b; padding: 40px; border-radius: 24px; text-align: center;">
        <h2 id="alarm-title" style="color: #f43f5e; margin-bottom: 20px;">‚è∞ H·∫æT GI·ªú R·ªíI!</h2>
        <button class="action-btn btn-primary" onclick="stopAlarm()">T·∫ÆT CHU√îNG</button>
    </div>
</div>

<script>
    let timerId, alarmInterval, fireworkInterval;
    let isPaused = false, isEditMode = false;
    let currentEditType = 'countdown'; 
    
    const elH = document.getElementById('hh'), elM = document.getElementById('mm'), elS = document.getElementById('ss');
    const lblH = document.getElementById('l-h'), lblM = document.getElementById('l-m'), lblS = document.getElementById('l-s');
    const modeText = document.getElementById('mode-text'), pauseBtn = document.getElementById('pause-btn');
    const mainBtn = document.getElementById('main-action-btn');
    const secBox = document.getElementById('sec-box'), sep2 = document.getElementById('sep-2');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    window.onload = () => {
        const savedTheme = localStorage.getItem('theme') || 'purple';
        document.body.setAttribute('data-theme', savedTheme);
        const savedStyle = localStorage.getItem('timerStyle') || 'default';
        document.body.setAttribute('data-style', savedStyle);
        if(savedStyle === 'flip') document.getElementById('style-icon').classList.add('active-style');

        const type = localStorage.getItem('timerType');
        if (type) {
            isPaused = localStorage.getItem('isPaused') === 'true';
            if (isPaused) pauseBtn.innerText = "Ti·∫øp t·ª•c";
            updateModeUI(type);
            startLoop();
        }
    };

    function updateModeUI(type) {
        secBox.style.display = (type === 'alarm') ? 'none' : 'block';
        sep2.style.display = (type === 'alarm') ? 'none' : 'block';
        if (type === 'tet') {
            modeText.innerText = "üßß CH·ªú T·∫æT 2026";
            lblH.innerText = "DAY"; lblM.innerText = "HOUR"; lblS.innerText = "MIN/SEC";
        } else {
            lblH.innerText = "HOUR"; lblM.innerText = "MIN"; lblS.innerText = "SEC";
            if (type === 'stopwatch') modeText.innerText = "ƒêANG B·∫§M GI·ªú";
            else if (type === 'clock') modeText.innerText = "üïí GI·ªú HI·ªÜN T·∫†I";
            else if (type === 'alarm') { }
            else modeText.innerText = "ƒêANG ƒê·∫æM NG∆Ø·ª¢C";
        }
    }

    // Logic ƒë·ªïi giao di·ªán s·ªë (M·ªõi)
    function toggleStyle() {
        const current = document.body.getAttribute('data-style');
        const next = current === 'default' ? 'flip' : 'default';
        document.body.setAttribute('data-style', next);
        localStorage.setItem('timerStyle', next);
        document.getElementById('style-icon').classList.toggle('active-style', next === 'flip');
    }

    function clearIfZero(el) {
        if (!isEditMode) return;
        if (el.innerText === "00") el.innerText = "";
    }

    function enableManualEdit(mode) {
        resetAll();
        isEditMode = true; currentEditType = mode;
        modeText.innerText = (mode === 'alarm') ? "NH·∫¨P GI·ªú B√ÅO TH·ª®C (24H)" : "CH·∫æ ƒê·ªò CH·ªàNH S·ª¨A";
        mainBtn.innerText = (mode === 'alarm') ? "ƒê·∫∂T B√ÅO TH·ª®C" : "B·∫ÆT ƒê·∫¶U ƒê·∫æM";
        mainBtn.onclick = () => initTimer(mode);
        if(mode === 'alarm') { secBox.style.display = 'none'; sep2.style.display = 'none'; }
        [elH, elM, elS].forEach(el => { el.contentEditable = "true"; el.classList.add('editable'); });
        elH.focus();
    }

    function disableManualEdit() {
        isEditMode = false;
        mainBtn.innerText = "B·∫•m gi·ªù"; mainBtn.onclick = () => initTimer('stopwatch');
        [elH, elM, elS].forEach(el => { el.contentEditable = "false"; el.classList.remove('editable'); });
    }

    function validateEntry(el) {
        let val = el.innerText.replace(/[^0-9]/g, '');
        if (!val) val = "00";
        if (el.id === 'hh' && parseInt(val) > 23 && currentEditType === 'alarm') val = "23";
        else if (el.id === 'hh' && parseInt(val) > 99) val = "99";
        if (el.id !== 'hh' && parseInt(val) > 59) val = "59";
        el.innerText = val.padStart(2, '0');
    }

    function initTimer(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        if (type === 'countdown' || type === 'manual') {
            const h = parseInt(elH.innerText) || 0, m = parseInt(elM.innerText) || 0, s = parseInt(elS.innerText) || 0;
            let durationMs = (h * 3600 + m * 60 + s) * 1000;
            if (durationMs <= 0) return alert("Vui l√≤ng nh·∫≠p th·ªùi gian!");
            localStorage.setItem('timerType', 'countdown'); localStorage.setItem('endTime', Date.now() + durationMs);
        } else if (type === 'alarm') {
            localStorage.setItem('timerType', 'alarm'); localStorage.setItem('alarmTime', elH.innerText + ":" + elM.innerText);
        } else if (type === 'stopwatch') {
            localStorage.setItem('timerType', 'stopwatch'); localStorage.setItem('startTime', Date.now());
        }
        disableManualEdit(); updateModeUI(localStorage.getItem('timerType'));
        isPaused = false; localStorage.setItem('isPaused', 'false');
        startLoop();
    }

    function startClockMode() {
        resetAll(); localStorage.setItem('timerType', 'clock');
        updateModeUI('clock'); startLoop();
    }

    function startLoop() {
        if (timerId) clearInterval(timerId);
        timerId = setInterval(update, 100);
    }

    function update() {
        if (isPaused || isEditMode) return;
        const type = localStorage.getItem('timerType');
        if (!type) return;

        const now = new Date();
        let dH, dM, dS;

        if (type === 'clock') {
            const days = ['Ch·ªß Nh·∫≠t', 'Th·ª© Hai', 'Th·ª© Ba', 'Th·ª© T∆∞', 'Th·ª© NƒÉm', 'Th·ª© S√°u', 'Th·ª© B·∫£y'];
            modeText.innerText = `üïí ${days[now.getDay()]}, ${now.getDate().toString().padStart(2,'0')}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getFullYear()}`;
            dH = now.getHours().toString().padStart(2, '0');
            dM = now.getMinutes().toString().padStart(2, '0');
            dS = now.getSeconds().toString().padStart(2, '0');
        } else if (type === 'alarm') {
            const aT = localStorage.getItem('alarmTime');
            const [aH, aM] = aT.split(':').map(Number);
            let alarmDate = new Date(); alarmDate.setHours(aH, aM, 0, 0);
            if (alarmDate <= now) alarmDate.setDate(alarmDate.getDate() + 1);
            const diff = alarmDate - now;
            const tS = Math.floor(diff / 1000);
            modeText.innerText = `üîî REO SAU: ${Math.floor(tS/3600)}G ${Math.floor((tS%3600)/60)}P ${tS%60}S`;
            dH = now.getHours().toString().padStart(2, '0');
            dM = now.getMinutes().toString().padStart(2, '0');
            dS = now.getSeconds().toString().padStart(2, '0');
            if (now.getHours() === aH && now.getMinutes() === aM && now.getSeconds() === 0) { clearInterval(timerId); startAlarm("‚è∞ ƒê·∫æN GI·ªú B√ÅO TH·ª®C!"); }
        } else if (type === 'countdown' || type === 'tet') {
            const end = parseInt(localStorage.getItem('endTime')) || 0;
            let diff = Math.max(0, end - now.getTime());
            if (diff <= 0 && type === 'tet') { clearInterval(timerId); triggerFirework(); startAlarm("üß® CH√öC M·ª™NG NƒÇM M·ªöI 2026!"); } 
            else if (diff <= 0 && type === 'countdown') { clearInterval(timerId); startAlarm("‚è∞ H·∫æT GI·ªú R·ªíI!"); }
            const tS = Math.floor(diff / 1000);
            if (type === 'tet') {
                dH = Math.floor(tS / (3600 * 24)).toString().padStart(2, '0');
                dM = Math.floor((tS % (3600 * 24)) / 3600).toString().padStart(2, '0');
                dS = Math.floor((tS % 3600) / 60).toString().padStart(2, '0') + ":" + (tS % 60).toString().padStart(2, '0');
            } else {
                dH = Math.floor(tS / 3600).toString().padStart(2, '0');
                dM = Math.floor((tS % 3600) / 60).toString().padStart(2, '0');
                dS = (tS % 60).toString().padStart(2, '0');
            }
        } else {
            const start = parseInt(localStorage.getItem('startTime')) || 0;
            const diff = now.getTime() - start;
            const tS = Math.floor(diff / 1000);
            dH = Math.floor(tS / 3600).toString().padStart(2, '0');
            dM = Math.floor((tS % 3600) / 60).toString().padStart(2, '0');
            dS = (tS % 60).toString().padStart(2, '0');
        }

        elH.innerText = dH; elM.innerText = dM; 
        if(type !== 'alarm') elS.innerText = dS;
        document.title = `${dH}:${dM}${type!=='alarm'?':'+dS:''} - Timer`;
    }

    function triggerFirework() {
        const duration = 15 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        function randomInRange(min, max) { return Math.random() * (max - min) + min; }
        fireworkInterval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(fireworkInterval);
            const particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }

    function togglePause() {
        const type = localStorage.getItem('timerType');
        if (!type || type === 'alarm' || type === 'clock') return;
        isPaused = !isPaused; localStorage.setItem('isPaused', isPaused);
        if (isPaused) { localStorage.setItem('pausedAt', Date.now()); pauseBtn.innerText = "Ti·∫øp t·ª•c"; }
        else {
            const gap = Date.now() - parseInt(localStorage.getItem('pausedAt'));
            if (type === 'stopwatch') localStorage.setItem('startTime', (parseInt(localStorage.getItem('startTime')) + gap));
            else localStorage.setItem('endTime', (parseInt(localStorage.getItem('endTime')) + gap));
            pauseBtn.innerText = "T·∫°m d·ª´ng";
        }
    }

    function resetAll() {
        clearInterval(timerId); clearInterval(alarmInterval); clearInterval(fireworkInterval);
        localStorage.removeItem('timerType'); localStorage.removeItem('startTime');
        localStorage.removeItem('endTime'); localStorage.removeItem('isPaused'); localStorage.removeItem('alarmTime');
        disableManualEdit(); secBox.style.display = 'block'; sep2.style.display = 'block';
        elH.innerText = elM.innerText = elS.innerText = "00";
        lblH.innerText = "HOUR"; lblM.innerText = "MIN"; lblS.innerText = "SEC";
        document.title = "00:00:00 - Timer Pro";
        modeText.innerText = "S·∫¥N S√ÄNG"; pauseBtn.innerText = "T·∫°m d·ª´ng";
        document.getElementById('alarm-modal').style.display = 'none'; isPaused = false;
    }

    function startTetCountdown() {
        resetAll(); 
        const tetDate = new Date('February 17, 2026 00:00:00').getTime();
        localStorage.setItem('timerType', 'tet'); localStorage.setItem('endTime', tetDate);
        updateModeUI('tet'); startLoop();
    }

    function toggleTheme() {
        const current = document.body.getAttribute('data-theme');
        const nt = current === 'purple' ? 'dark' : 'purple';
        document.body.setAttribute('data-theme', nt);
        localStorage.setItem('theme', nt);
    }

    function startAlarm(txt) {
        document.getElementById('alarm-title').innerText = txt;
        document.getElementById('alarm-modal').style.display = 'flex';
        alarmInterval = setInterval(() => {
            let o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.2);
        }, 800);
    }

    function stopAlarm() { clearInterval(alarmInterval); clearInterval(fireworkInterval); resetAll(); }
</script>
</body>
</html>
